\documentclass[reqno]{article}

\usepackage{fullpage}
\usepackage{eufrak}
\usepackage{listings}
\usepackage{color}
\usepackage{xcolor}
\usepackage{enumitem}


% \usepackage{nth}
\usepackage{amsthm, amsmath, amsfonts, amssymb}


%formatting
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm,bindingoffset=0cm]{geometry}
\renewcommand{\baselinestretch}{1.2}
\sloppy

\setlength{\parindent}{0pt}
\setlength{\parskip}{0.3em}

\usepackage{multicol}
\usepackage{color}

% Languages, fonts and symbols
\usepackage[english,russian]{babel}
\usepackage[T1,T2A]{fontenc}
\usepackage[utf8]{inputenc}

\usepackage{amsmath}

\usepackage{graphicx}

\usepackage{subcaption}

\usepackage{amssymb}

\usepackage{listings}

\usepackage{float}

\usepackage{dsfont}

\usepackage{ragged2e}

\usepackage{tabularx}


%\usepackage{algorithm}
\usepackage[ruled,vlined]{algorithm2e}

\SetKwInput{KwInput}{Input}                % Set the Input
\SetKwInput{KwOutput}{Output}              % set the Output


% tikz graphics
% Для коммутативных диаграмм.
\usepackage{tikz}
\usetikzlibrary{arrows,shapes}
\tikzstyle{vertex}=[circle,fill=black,minimum size=3pt,inner sep=0pt]
\tikzstyle{edge} = [draw,thick,-]

\usepackage{tikz-cd}

\usetikzlibrary{quotes,babel,angles}


% Теоремы и прочее
\renewcommand\qedsymbol{$\square$}

\theoremstyle{definition}
\newtheorem*{nb}{Замечание}

\theoremstyle{definition}
\newtheorem*{sol}{Решение}

\theoremstyle{definition}
\newtheorem*{exmp}{Пример}

\theoremstyle{definition}
\newtheorem*{exmps}{Примеры}

\theoremstyle{definition}
\newtheorem{exc}{Упражнение}[section]

\theoremstyle{definition}
\newtheorem{thm}{Теорема}[section]

\theoremstyle{definition}
\newtheorem*{defi}{Определение}

\theoremstyle{definition}
\newtheorem{coll}{Следствие}[section]

\theoremstyle{definition}
\newtheorem{state}{Утверждение}[section]


%Content as links
% Для того, чтобы оглавление стало ссылками, убрать комментирование кода ниже.

\usepackage[hidelinks]{hyperref}
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
   urlcolor=black
}


% Title
\title{Управление доходами.\\ Лекции.\\ ЧЕРНОВИК}
\author{Лектор: Фридман Г.М.\\  \\ Автор конспекта: Курмазов Ф.А.\thanks{f.kurmazov.b@gmail.com}}
\date{\today}


% New Symbols
\newcommand*{\divby}{\mathrel{\rotatebox{90}{$\hskip-1pt.{}.{}.$}}}%




\begin{document}

	\maketitle

	\tableofcontents


	%%%%%
	\newpage
	\section{Лекция 1. Введение в управление доходами.}
		%%%
		\subsection{Формулировка задачи.}
			
		Управление доходами (англ. Revenue Management) -- область исследования операций, занимающаяся преимущественно моделлированием и оптимизацией процессов, связанных с оптимизацией поведения производителя товаров/услуг на микро уровне. Основная цель -- продажа правильного товара, правильному покупателю, в правильном месте, в правильное время, с целью максимизации роста выручки. Таким образом область сочетает в себе методы оптимизации, математической статистики, микро- и макроэкономики.
		
		\textcolor{red}{Конечно, надо написать первую лекцию. Желательно тому, кто ее писал.}
		
		%%%
		\subsection{Общая формулировка задачи определения оптимальной стратегии продаж авиакомпании.}
			Авиакомпания предлагает на рынке O-D ряд продуктов, каждый из которых представляет собой комбинацию ``маршрут-класс билета'', где класс билета -- его цена. Спрос на каждый продукт, обычно, предсказывается заранее (вне данной модели), и обычно разбивается на несколько временных интервалов (DCP -- data collection periods).
			
			Авиакомпания хочет продавать все продукты таким образом, чтобы получить максимальных доход, учитывая при этом естественные ограничения вроде: заданный общий спрос, цена билетов, вместимость самолетов на рейсах, из которых состоят маршруты. Т.о. авиакомпания хочет найти оптимальную стратегию продаж, основанную на прогнозе спроса, физических ограничениях и реальном потоке запросов/покупателей.
		
		%%%
		\subsection{Простейшая модель оптимизации стратегии продаж авиакомпании.}
	
		Заданы:
		\begin{itemize}
			\item Множество рейсов $Flights = [F]$\footnote{Здесь и далее, принята нотация $[n] = \{1, 2, 3, ... n\}$.}
			\item Множество продуктов авикакопании $G = [N]$.
			\item Вектор вместимости рейсов $cap \in \mathds{N}^F$
			\item Продукт $i \in G$ состоит из маршрута $Path_i \subseteq Flights$, при чем связного (i.e. путь в графе терминалов), и некоторой стоимости $p_i$ (i.e. класс обслуживания).
			\item Вектор стоимостей продуктов $p \in \mathds{N}^N$.
			\item Вектор спрогнозированного спроса на продукты $d \in \mathds{N}^N$.
		
		\end{itemize}
	
		Цель задачи найти $x \in \mathds{N}^N$ -- количество продуктов каждого типа, которое компания разместит на рынке, максимизирующее выручку компании.
		
		Пусть $A$ -- матрица $N\times F$, в которой $a_{i, j} = 1$, если $i$-й рейс входит в $j$-й продукт (i.e. содержится в нем в качестве маршрута), и $a_{i, j} = 0$ иначе.
		
		Тогда линейная целочисленная программа соответствующая задаче может быть записана:
		$$
		\begin{cases}
			p^T x &\rightarrow \max_x\\
			A\,x  &\leq cap\\
			x     &\leq d\\
			x \in \{0, 1\}^N &
		\end{cases}
		$$
	
	
	
	%%%%%
	\newpage
	\section{Лекция 2. Имитационная модель и Пределы бронирования.}
		%%%
		\subsection{Стратегии продаж.}
		
		Шкалу времени можно разбить на периоды по DCP (англ. data collection points/periods) -- точкам, в которых компания может принимать управленческие решения.
		
		Главный недостаток детерминированной модели -- слабая описательная способность реальной ситуации, и негибкость во времени.
		
		При использовании прогноза на спрос важно знать точность этого прогноза, для анализа эффективности выработанной стратегии.
		
		Возможные стратегии продаж:
		\begin{itemize}
			\item Первый пришел - первый купил (англ. first come first served -- FCFS);
			\item Оптимальная стратегия для одной начальной точки DCP (1DCP);
			\item Оптимальная стратегия для четырех точек DCP (4DCP);
		\end{itemize}
	
	
		%%%
		\subsection{Описание имитационной модели.}
		
		
		Для имитации реального процесса продажи билетов можно принять поток запросов распределенным нормально, с параметрами $\mu = k_1 d_{i t}$, $\sigma = k_2 \sqrt{d_{i t}}$. Где $k_1$, $k_2$ -- ошибки прогноза мат. ожидания и ско соответственно.
		
		Для каждого периода и для каждого вида товара можно сгенерировать (имитация) свой поток запросов на покупку. Каждый такой запрос может быть удовлетворен или отклонен, в зависимости от выбранной стратегии.
		
		При каждом удовлетворении запроса требуется поддерживать естественные ограничения (т.е. уменьшать число оставшихся мест на рейсах).
		
		По результату работы имитационной модели можно оценить отношение полученной выручки (в результате выбранной стратегии) к максимальной выручке, доступной при данном потоке требований.
		
		
		%%%
		\subsection{Пределы бронирования.}
		
		Предел бронирования (англ. booking limit) $b$ -- количество билетов, которые мы готовы продать в данном ценовом классе.
		
		Пределы бронирования могут быть вложенными и невложенными.
		
		Вложенные пределы бронирования предполагают, что компания готова продать товар меньшей стоимости по стоимости более дорогого товара. Тем не менее, компания заранее ``ждет'' заданное количество ``богатых'' покупателей, в связи с чем резервирует для них билеты, и защищает их от покупки по меньшей стоимости.
		
		Уровень защиты $y$ (англ. protection levels) -- сколько билетов защищено в данном и более высоких ценовых классах.
		
		Для выбора уровня защиты можно оценивать ожидаемую выручку от $k$-го билета дорогого класса, и сравнивать ее с ожидаемой выручкой при продаже этого билета по меньшей стоимости, в зависимости от распределения количества заявок на покупку того или иного класса.
		
		
		%%%
		\subsection{Пределы бронирования.}
		
		
		
		
		
		%%%%%
		\newpage
		\section{Лекция 3. Stochastic models I. Protection levels.}
		
		%%%
		\subsection{Littlewood's rule.}
		
		Пример: при наличии 2-ух классов билетов, и при условии, что спрос на дешевый класс избыточен, можем положить, что спрос на дорогой класс имеет функцию распределения ${F}$. Тогда оценить количество мест, которое стоит зарезервировать под дррогой класс можно следующим образом:
		
		$$limit = \max x \mid x \in \mathds{N} \vee E[P(x)] = p_1 * F(x) > p_2$$
		
		где $p_1$ $p_2$ цена на дорогой и на дешевый классы соответственно, $P(x)$ -- прибыль от продажи дорогих билетов при пределе бронирования $x$. \textcolor{red}{Перепроверить что тут вообще написано, формально.}
		
		%%%
		\subsection{EMSRb.}
		
		EMSRb (Expected Marginal Set Revenue).
		
		...
		
		
		%%%
		\subsection{EMSRa.}
		...
		
	
	%%%%%
	\newpage
	\section{Лекция 4. Stochastic models II. Stochastic DLP.}
			
		%%%
		\subsection{Probabilistic Non-Linear Problem (PNLP).}
		
		\begin{multicols}{2}
			$$
			\text{(DLP)}:
			\begin{cases}
				f^Tx \rightarrow \max & \\
				Ax \leq Cap & \\
				0 \leq x \leq \mathds{E}(\mathfrak{D}) & \\
			\end{cases}	
			$$
			
			\columnbreak
			
			$$
			\text{(PNLP)}
			\begin{cases}
				\sum\limits_{j=1}^n f_j \mathds{E}(\mathfrak{b_j}) \rightarrow \max & \\
				Ax \leq Cap & \\
				x \geq 0 & \\
			\end{cases}
			$$
		\end{multicols}
		
		где $\mathfrak{D}$ -- спрос ($\mathfrak{D}_j$ -- спрос на $j$ продукт -- дискретная положительная случайная величина), $\mathds{E}$ -- мат. ожидание, $f \in \mathds{R}^N$ -- вектор цен, $A \in \{0, 1\}^{F x N}$ -- матрица маршрутов, $Cap \in \mathds{Z}^F$ -- вектор вместимости, $x$ -- переменная, обозначающая объемы продукции.
		
		Мы можем предположить, что нам известен закон распределения $\mathfrak{D}_j \sim F_j$, что эквивалентно тому, что известны $Pr[\mathfrak{D}_j = s]\,\forall\,s \in \{0, 1, 2, ...\}$.
		
		Интерпретируем переменную $x_j$ -- как количество товара $j$, которое мы хотим продать. Введем $b_j$ -- количество проданных билетов на продукт $j$, при условии выбраннго $x_j$. Таким образом $b_j$ -- дискретная случайная величина, которая принимает целочисленные значения от $0$ до $x_j$. На самом деле, $b_j = \min(x_j, \mathfrak{D}_j)$. Тогда можем выразить вероятность:
		
		$$
		\begin{array}{l}
			Pr[b_j = s] = Pr[\mathfrak{D}_j = s]\quad 0 \leq s < x_j \\
			Pr[b_j = s] = Pr[\mathfrak{D}_j \geq x_j]\quad s = x_j
		\end{array}
		$$
		
		Откуда следует
		
		$$Pr[b_j \geq s] = Pr[\mathfrak{D}_j \geq s]\quad \forall\,0 \leq s \leq x_j$$
		
		$$Pr[b_j = x_j] = Pr[b_j \geq x_j] = Pr[\mathfrak{D}_j \geq x_j]$$
		
		Определение математического ожидания СВ $\xi$ со значениями в $\{0, 1, 2, 3, ..., n\}$:
		
		$$\mathds{E}[\xi] = \sum\limits_{s = 0}^S s\,Pr[\xi = s] = Pr[\xi = 1] + 2\,Pr[\xi = 2] + ... + S\,Pr[\xi = S]$$
		
		Перегруппируя члены можно получить формулу
		
		\begin{equation}
			\mathds{E}[\xi] = \sum\limits_{s = 1}^S Pr[\xi \geq s]
		\end{equation}
		
		
		Тогда можно расписать математическое ожидание $b_j$:
		
		$$\mathds{E}[b_j] = \sum\limits_{s = 1}^{x_j} s\,Pr[b_j = s] = \sum\limits_{s = 1}^{x_j} Pr[b_j \geq s] = \sum\limits_{s = 1}^{x_j} Pr[\mathfrak{D}_j \geq s]$$
		
		Введем обозначения, и перепишем полученную формулу:
		
		$$P_{j,s} := Pr[\mathfrak{D}_j \geq s]\quad s = 1, 2, ..., x_j$$
		
		\begin{equation}
			\mathds{E}[b_j] = \sum\limits_{s = 1}^{x_j} P_{js}
		\end{equation}
		
		Тогда получим целевую функцию для (stochastic DLP):
		
		\begin{equation}
			\sum\limits_{j=1}^n f_j \mathds{E}[b_j] = \sum\limits_{j=1}^n f_j \sum\limits_{s = 1}^{x_j} P_{j,s} \rightarrow \max
		\end{equation}
	
		Но работать с дискретными случайными величинами не всегда удобно. В связи с чем можно перейти к непрерывным распределениям случайных величин. В частности, можно предположить, что спрос распределен нормально:
		
		$$\mathds{D}_j \sim \mathcal{N}(\mu_j, \sigma_j) \quad \forall\, j \in [N]$$
		$$\mathcal{N}(\mu, \sigma, x) = \frac{1}{2}(1 + {erf}(\frac{x - \mu}{\sqrt{2}\sigma}))$$
		
		Переходим к аппроксимации дискретного распределения нормальным:
		
		$$P_{js} = Pr[\mathds{D}_j \geq s] \approx 1 - \mathcal{N}(\mu_j, \sigma_j, s)$$
		$$\mathds{E}[b_j] = \sum\limits_{s = 1}^{x_j} (1 - \mathcal{N}(\mu_j, \sigma_j, s))$$
		$$\sum\limits^n_{j = 1} f_j\,\mathds{E}[b_j] = \sum\limits^n_{j = 1} f_j\,\sum\limits_{s = 1}^{x_j} (1 - \mathcal{N}(\mu_j, \sigma_j, s))$$
		
		Но иметь переменный предел суммирования для задачи оптимизации не очень удобно. Теперь переформулируем задачу так, чтобы избавиться от верхнего предела суммирования. Введем наборы цепных бинарных переменных $x_{j,s}$ для $s = 1, 2, ... Cap$.
		
		$$
		\begin{cases}
			x_{j,s} =
		\begin{cases}
			1 & \text{для продукта j продали билет s}\\
			0 & else\\
		\end{cases} & \\
		x_{j,s + 1} \leq x_{j, s}\quad \forall s \in [Cap - 1] & \\
		\end{cases}
		$$
		
		\textcolor{red}{Дальше (а может и перед) точно есть ошибки в индексах и в целом, перечитаю позже а пока у меня дедлайны.}
		
		С новой целевой функцией:
		
		$$\sum\limits^n_{j = 1} f_j \sum\limits^{\max Cap}_{s = 1} x_{j, s}\,(1 - \mathcal{N}(\mu_j, \sigma_j, s)) \rightarrow \max$$
		
		И новым ограничением вместимости:
		
		$$\sum\limits_{j : F_j \ni k} \sum\limits^{\max Cap}_{s = 1} x_{j, s} \leq Cap_k \quad \forall k \in [F]$$
		
		Откуда получим $0$-$1$ формулировку (stochastic DLP):
		
		$$
		\text{(0-1 PNLP)}
		\begin{cases}
			\sum\limits^n_{j = 1} f_j \sum\limits^{\max Cap}_{s = 1} x_{j, s}\,(1 - \mathcal{N}(\mu_j, \sigma_j, s)) \rightarrow \max & \\
			\sum\limits_{j : F_j \ni k} \sum\limits^{\max Cap}_{s = 1} x_{j, s} \leq Cap_k & \forall k \in [F] \\
			x_{j,s + 1} - x_{j, s} \leq 0 \quad & \forall\, j \in [N],\, \forall\, s \in [Cap - 1] \\
			x_{j, s} \geq 0 &  \forall\, j \in [N],\, \forall\, s \in [Cap] \\
		\end{cases}
		$$
		
		%%%
		\subsection{Randomized Linear Problem (RLP).}
		
		$$
		\text{(RLP)}:
		\begin{cases}
			f^Tx \rightarrow \max & \\
			Ax \leq Cap & \\
			0 \leq x \leq \mathfrak{D}_i & \\
		\end{cases}	
		$$
		
		где $\mathfrak{D}_i$ -- конкретная реализация СВ -- спроса.
		
		В (RLP) запускается множество экспериментов, а финальный ответ берется в виде среднего по всем решениям $x^* = \frac{1}{n}\sum\limits^n_{i = 1} {x^*}^i$, с последующим \textit{умным} округлением каждой координаты.
		
		
		%%%
		\subsection{Demand forecasting. Naive methods.}
		
		На практике, с целью прогнозирования спроса, могут быть использованы исторические данные (временные ряды). Но у этого подхода есть проблема. Исторические данные о спросе являются цензурированными. Другими словами, мы можем разделить точки истроического периода на истинные и цензурированные, где истинный спрос -- весь истроические спрос, меньший предела продаж, а цензурированный -- точки, в которых количество продаж равно пределу. Это связано с тем, что мы никак не можем отследить спрос, превышающий предел продаж.
		
		В связи с этим возникает отдельная проблема -- оценить распределение спроса в условиях цензурированных исторических данных. Существует множество методов. Рассмотрим наивные:
		
		\textbf{Naive 1:} все цензурированные элементы заменить на среднее по всей выборке. Получим $\pm$ хорошее $\mu$, но плохое $\sigma$, за счет потери дисперсии.
		
		
		
		
\end{document}



% Examples and Shortcuts
$
	\begin{defi}
	Определение чего-то
	\end{defi}


	\begin{thm}

	\end{thm}	


	\begin{coll}

	\end{coll}	

	
	\begin{nb}

	\end{nb}	

	
	\begin{nb}

	\end{nb}	


	\begin{exmp}

	\end{exmp}	


	\begin{tikzcd}
	A \arrow[rd] \arrow[r, "\phi"] 
	&B \\
	& C \arrow[u]
	\end{tikzcd}

	% Пример мат. постановки

	$$\text{min} \quad \sum\limits_{e \in E} x_e$$
	
	$$
	\text{s.t.}
	\begin{cases}
		\sum\limits_{e \in E_v} x_e \geq 1& \forall v \in V\\
		x \in \{0, 1\}^{|E|} &
	\end{cases}
	$$

	% Пример алгоритма

	\begin{algorithm}[H]
		\SetAlgoLined
		 \SetKwFunction{FDFS}{DFS}
		 \SetKwProg{Fn}{Function}{:}{}
		 \Fn{\FDFS{$u$}}{
			$VisitFunc(u)$\;
			$visited[u] = True$\;
		        \For{$w \in \text{adj}[u]$}
						{
							\If{$visited[w] = False$}
								{
								$FoundFunc(w)$\;
								$\text{DFS}(w)$\;
								}						
							}
			$OutFunc(u)$\;
		        }

		DFS(start)
		\caption{Depth-first search}
	\end{algorithm}





Случайное число, попадая в тот или иной промежуток будет характеризовать реализацию этого варианта.  Например, вероятность пессимистического варианта = 2/9; целевого = 6/9; оптимистического = 1/9. Если случайное число в интервале от 0 до 2/9, то поток вложений будет равен пессимистической величине вложений, если от 2/9 до 6/9, то целевому, если больше, то оптимистическому.
